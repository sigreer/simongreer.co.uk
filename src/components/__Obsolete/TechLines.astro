---
import { getCollection } from 'astro:content';
import { Image } from 'astro:assets';

interface Props {
  currentSlug?: string;
  limit?: number;
}

const { currentSlug, limit = 6 } = Astro.props;
const techs = await getCollection('tech');
const filteredTechs = currentSlug 
  ? techs.filter(tech => tech.data.slug !== currentSlug)
  : techs;

const allVendorIcons = import.meta.glob('../images/vendor-icons/*', { eager: true });
---

<div class="rounded-lg w-full bg-white">
  <ul class="flex flex-col py-0">
    {
      filteredTechs.slice(0, limit).map((tech) => {
        const vendorIcon = tech.data.vendoricon 
          ? allVendorIcons[`../images/vendor-icons/${tech.data.vendoricon}`]?.default 
          : null;
        return (
          <li class="flex flex-col bg-white hover:shadow-lg hover:scale-105 transition h-24 [&:not(:last-child)]:border-b [&:not(:last-child)]:border-dotted [&:not(:last-child)]:border-gray-200">
            <a href={`/tech/${tech.data.slug}`} class="flex flex-row gap-x-1 p-1 relative h-full">
              {vendorIcon && (
                <div class="w-1/5 overflow-hidden">
                  <Image 
                    src={vendorIcon} 
                    alt={tech.data.title}
                    width={120}
                    height={120}
                    class="h-full w-full object-cover object-center rounded-l-md"
                  />
                </div>
              )}
              <div class="flex flex-col gap-y-0 py-1 px-4 w-4/5">
                <h3 class="text-base font-semibold line-clamp-2 py-0 leading-5">
                  {tech.data.title}
                </h3>
                {tech.data.tags && tech.data.tags.length > 0 && (
                  <div class="flex flex-wrap gap-1 tag-block">
                    {tech.data.tags.map((tag) => (
                      <span
                        class="rounded-md px-2 py-1 text-xs md:text-sm font-semibold text-white shadow-sm-light transition tag-style" 
                        data-tag={tag}
                      >
                        {tag}
                      </span>
                    ))}
                  </div>
                )}
              </div>
            </a>
          </li>
        );
      })
    }
  </ul>
</div>